/*! Source file from the docmd project â€” https://github.com/docmd-io/docmd */


(function(){let y=null,m=!1,n=-1;const l=document.getElementById("docmd-search-modal"),d=document.getElementById("docmd-search-input"),r=document.getElementById("docmd-search-results"),v=window.DOCMD_ROOT||"./";if(!l)return;const w='<div class="search-initial">Type to start searching...</div>';function x(){l.style.display="flex",d.focus(),d.value.trim()||(r.innerHTML=w,n=-1),m||S()}function f(){l.style.display="none",n=-1}document.addEventListener("keydown",e=>{if((e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),l.style.display==="flex"?f():x()),l.style.display==="flex"){const t=r.querySelectorAll(".search-result-item");if(e.key==="Escape")e.preventDefault(),f();else if(e.key==="ArrowDown"){if(e.preventDefault(),t.length===0)return;n=(n+1)%t.length,p(t)}else if(e.key==="ArrowUp"){if(e.preventDefault(),t.length===0)return;n=(n-1+t.length)%t.length,p(t)}else e.key==="Enter"&&(e.preventDefault(),n>=0&&t[n]?t[n].click():t.length>0&&t[0].click())}});function p(e){e.forEach((t,s)=>{s===n?(t.classList.add("selected"),t.scrollIntoView({block:"nearest"})):t.classList.remove("selected")})}document.querySelectorAll(".docmd-search-trigger").forEach(e=>{e.addEventListener("click",x)}),l.addEventListener("click",e=>{e.target===l&&f()});async function S(){try{const e=`${v}search-index.json`,t=await fetch(e);if(!t.ok)throw new Error(t.status);const s=await t.text();y=MiniSearch.loadJSON(s,{fields:["title","headings","text"],storeFields:["title","id","text"],searchOptions:{fuzzy:.2,prefix:!0,boost:{title:2,headings:1.5}}}),m=!0,d.value.trim()&&d.dispatchEvent(new Event("input"))}catch(e){console.error("Failed to load search index",e),r.innerHTML='<div class="search-error">Failed to load search index.</div>'}}function L(e,t){if(!e)return"";const s=t.split(/\s+/).filter(o=>o.length>2),c=e.toLowerCase();let i=-1;for(const o of s){const E=c.indexOf(o.toLowerCase());if(E>=0){i=E;break}}const u=60;let h=0,g=120;i>=0&&(h=Math.max(0,i-u),g=Math.min(e.length,i+u));let a=e.substring(h,g);h>0&&(a="..."+a),g<e.length&&(a=a+"...");const k=s.map(o=>o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|");if(k){const o=new RegExp(`(${k})`,"gi");a=a.replace(o,"<mark>$1</mark>")}return a}d.addEventListener("input",e=>{const t=e.target.value.trim();if(n=-1,!t){r.innerHTML=w;return}if(!m)return;const s=y.search(t);T(s,t)});function T(e,t){if(e.length===0){r.innerHTML='<div class="search-no-results">No results found.</div>';return}const s=e.slice(0,10).map((c,i)=>{const u=L(c.text,t);return`
                <a href="${`${v}${c.id}`}" class="search-result-item" data-index="${i}" onclick="window.closeDocmdSearch()">
                    <div class="search-result-title">${c.title}</div>
                    <div class="search-result-preview">${u}</div>
                </a>
            `}).join("");r.innerHTML=s,r.querySelectorAll(".search-result-item").forEach((c,i)=>{c.addEventListener("mouseenter",()=>{n=i,p(r.querySelectorAll(".search-result-item"))})})}window.closeDocmdSearch=f})();
